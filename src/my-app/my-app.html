<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/app-layout/app-layout.html">
<link rel="import" href="../../../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Raleway" />

<dom-module id="my-app">
  <template>
    <style is="custom-style" include="iron-flex iron-flex-alignment">
      :host {
        --app-primary-color: #D50000;
        /*--app-primary-color: #212121;*/
        --app-secondary-color: black;
        --app-drawer-width: 200px;

        display: block;
      }
      app-header {
        color: #fff;
        background-color: var(--app-primary-color);
      }
      app-drawer {
        --app-drawer-content-container: {
          background-color: #F1F1F1;
        };
      }
      /*app-drawer-layout:not([narrow]) [drawer-toggle] {
        display: none;
      }*/
      app-drawer-layout {
        --app-drawer-layout-content-transition: margin 0.2s;
      }
      h2 {
        /*font-family: Raleway;*/
      }
      iframe {
        box-shadow: 0px 0px 4px #000000;
      }
      paper-button {
        width: 100%;
        margin: 0px 0px 0px 0px;
        border-radius: 0px;
        text-transform: capitalize;
      }
      paper-button iron-icon {
        margin: 0px 10px 0px 5px;
      }
      paper-card {
        margin: 0px 0px 10px 0px;
      }
      #drawerContent {
        margin-top: 80px;
        height: calc(100% - 80px);
        overflow: auto;
      }
      #leaderboardButton {
        width: 160px;
        background-color: #F1F1F1;
        color: #E53935;
      }
      #leaderboardContainer {
        height: 400px;
        width: 80%;
        /*background-color: black;*/
      }
      #leaderboardRight {
        color: #f1f1f1;
        padding: 0px 0px 0px 80px;
      }
      #leaderboardSection {
        height: 550px;
        background-color: #E53935;
      }
      #leaderboardSubtitle {
        margin: 20px 0px 20px 0px;
        line-height: 115%;
        text-align: center;
        font-size: 170%;
      }
      #leaderboardTitle {
        font-size: 220%;
        font-weight: bolder;
      }
      #mainTitle {
        margin-left: 15px;
      }
      #testButton {
        /*margin-top: 40px;*/
      }
      #welcomeSection {
        background-image: url("/img/ereve.png");
        height: 550px;
      }
      #welcomeContainer {
        height: 400px;
        width: 80%;
        margin: 70px 0px 0px 0px;
        /*background-color: rgba(0, 0, 0, 0.75);*/        
      }
      #welcomeTextContainer: {
        margin: 20px 0px 0px 0px;
        font-size: 200%;
      }
      #welcomeTitle {
        font-weight: bolder;
        margin: 0px 0px 10px 0px;
      }
      #welcomeSubtitle {
        font-weight: 300;
        font-size: 200%;
      }
      .fullWidth {
        width: 100%;
      }
      .fullHeight {
        height: 100%;
      }
      .playerCardPic {
        height: 80px;
        width: 80px;
      }
      .playCardProfile {

      }
      .whiteText {
        margin: 20px 60px 0px 0px;
        color: #ffffff;
        font-size: 220%;
        line-height: 110%;
        text-shadow: 2px 2px 3px #000000;
      }
      .raleway {
        font-family: Raleway;
      }
    </style>
  
    <app-header-layout fullbleed>
      <app-header fixed slot="header">
        <app-toolbar>
          <paper-icon-button id="drawerButton" icon="menu"></paper-icon-button>
          <div main-title><span id="mainTitle">MBR Boards</span></div>
        </app-toolbar>
      </app-header>

      <app-drawer-layout id="drawerLayout">
        <app-drawer opened id="drawer" slot="drawer">
          <div id="drawerContent">

            <paper-button class="horizontal start-justified layout"><iron-icon icon="home"></iron-icon>Home</paper-button>
            <paper-button class="horizontal start-justified layout"><iron-icon icon="list"></iron-icon>Leaderboards</paper-button>
            <paper-button class="horizontal start-justified layout"><iron-icon icon="search"></iron-icon>Search</paper-button>
            <paper-button class="horizontal start-justified layout"><iron-icon icon="social:people"></iron-icon>Profiles</paper-button>
            <paper-button class="horizontal start-justified layout"><iron-icon icon="info"></iron-icon>About</paper-button>

          </div>
        </app-drawer>

        <div id="siteContent">
          <!-- <div>It's the remix to ignition, hot and fresh out the kitchen.</div>
          <div>Featured Match</div>
          <div>Top 5 Leaderboards</div>
          <div>Top 5 Guild Leaderboards</div> -->
          <div id="welcomeSection" class="horizontal center-justified layout center fullWidth">
            <div id="welcomeContainer" class="horizontal layout">
              <div id="welcomeTextContainer" class="flex whiteText vertical start-justified layout center">
                <div>
                  <div id="welcomeTitle">Welcome to MBR Boards!</div>
                  For all things Maplemation<br>Battle Royale.
                </div>
              </div>
              <div id="welcomeVidContainer" class="flex horizontal start-justified layout">
                <iframe width="560" height="315" src="https://www.youtube.com/embed/WGd8eFRib5M" frameborder="0" allowfullscreen></iframe>
              </div>
            </div>
            <!-- <div id="leftWelcome" class="self-center vertical end-justified layout center fullHeight">
              <div id="welcomeTitle" class="raleway">Welcome to MBR Boards!</div>
              <div id="welcomeSubtitle" class="raleway">Watch this video to get started:</div>
            </div>
            <div id="rightWelcome" class="self-center fullHeight"></div> -->
          </div>
          <div id="leaderboardSection" class="horizontal center-justified layout center fullWidth">
            <div id="leaderboardContainer" class="horizontal layout">
              <div id="leaderboardLeft" class="flex vertical center-justified layout">

<!-- Rank, Image, Name, Guild, AP, Wins, Ties, Losses -->

                <template is='dom-repeat' items='[[top3]]' as="item">
                  <div>
                    
                    <paper-card class="fullWidth">
                      
                      <div class='card-content horizontal layout center'>
                        <div class="playerCardPic vertical center-justified layout center">
                          <iron-image src=[[item.pic_link]]></iron-image>
                        </div>
                        <div class="flex"><b>[[item.name]]</b><br><b>Faction: </b> [[_emptyBind(item.faction)]]<br><b>Rank: </b> [[_calculateRank(item.base_ap)]]</div>
                        <div></div>
                        <div class="flex"><b>AP:</b> [[item.base_ap]]<br><b>Record: </b> <span>[[item.record.win]]W</span>/<span>[[item.record.lose]]L</span>/<span>[[item.record.tie]]T</span><br><b>Mesos:</b> [[item.meso]]</div>
                        <paper-icon-button icon="social:person" class="playCardProfile relative self-end" style="top: 10px; left:5px"></paper-icon-button>
                      </div>  
                    </paper-card>
                  </div>
                </template>
                  
                <!-- <paper-card class="fullWidth">
                  <div class="card-content">
                    
                    <b>2k</b><br><b>Wins:</b> 59<br><b>Losses:</b> 9
                  </div>
                </paper-card>
                <paper-card class="fullWidth">
                  <div class="card-content">
                    <b>Lynus</b><br><b>Wins:</b> 37<br><b>Losses:</b> 10
                  </div>
                </paper-card>
                <paper-card class="fullWidth">
                  <div class="card-content">
                    <b>Aquila</b><br><b>Wins:</b> 29<br><b>Losses:</b> 8
                  </div>
                </paper-card> -->
              </div>
              <div id="leaderboardRight" class="flex vertical layout center">
                <div id="leaderboardTitle">Top 3 Leaderboard</div>
                <div id="leaderboardSubtitle" class="horizontal center-justified layout"><br><br>ENTER TROPHY VECTOR HERE<br><br>Here are the current top contenders in Maplemation Battle Royale. To view the full leaderboard, click below.</div>
                <paper-button id="leaderboardButton" raised>LEADERBOARD</paper-button>
              </div>
            </div>
          </div>
        </div>
      </app-drawer-layout>

    </app-header-layout>

    

    <!-- <iron-ajax
      auto
      id = "iajax"
      url = "http://localhost:3000/api/mbr_users/top"
      handle-as = "json"
      last-response = "{{response}}">
    </iron-ajax> -->

    <iron-ajax
      auto
      id = "top3Request"
      url = "http://localhost:3000/api/mbr_users/top"
      handle-as = "json"
      on-response = "handleTop3Response">
    </iron-ajax>

    <!-- <template is="dom-repeat" items="{{response}}">
      <div>
        {{item}}
      </div>
    </template> -->
  </template>

  <script>
    /**
     * @customElement
     * @polymer
     */
    class MyApp extends Polymer.Element {
      static get is() { return 'my-app'; }
      static get properties() {
        return {
          prop1: {
            type: Array
          },
          top3: {
            type: Array,
            value: [{
    "mm_id": 9,
    "name": "Spritefan2",
    "faction": "Flash",
    "base_ap": 3015,
    "meso": 14,
    "pic_link": "https://puu.sh/x3p7N/2e41c7f723.png",
    "ss_link": "",
    "profile_link": "",
    "record": {
        "win": 60,
        "lose": 1,
        "tie": 1
    },
    "medals": {
        "rivalry": 1,
        "quest": 3,
        "faction": 1,
        "patriotic": 0,
        "social": 3,
        "elite": 8
    },
    "stats": {
        "spl": 0.1,
        "atk": 0.1,
        "def": 0.5,
        "luk": 0.1,
        "wis": 0.1,
        "stm": 0.1
    }
},
{
    "mm_id": 9,
    "name": "Koonts",
    "faction": "",
    "base_ap": 1250,
    "meso": 9,
    "pic_link": "https://puu.sh/x3oK8/f3153e8ede.png",
    "ss_link": "",
    "profile_link": "",
    "record": {
        "win": 20,
        "lose": 2,
        "tie": 3
    },
    "medals": {
        "rivalry": 1,
        "quest": 3,
        "faction": 1,
        "patriotic": 0,
        "social": 3,
        "elite": 8
    },
    "stats": {
        "spl": 0.1,
        "atk": 0.1,
        "def": 0.5,
        "luk": 0.1,
        "wis": 0.1,
        "stm": 0.1
    }
},
{
    "mm_id": 9,
    "name": "i_st",
    "faction": "",
    "base_ap": 1000,
    "meso": 4,
    "pic_link": "https://puu.sh/x3vTT/c0058722df.png",
    "ss_link": "",
    "profile_link": "",
    "record": {
        "win": 10,
        "lose": 10,
        "tie": 10
    },
    "medals": {
        "rivalry": 1,
        "quest": 3,
        "faction": 1,
        "patriotic": 0,
        "social": 3,
        "elite": 8
    },
    "stats": {
        "spl": 0.1,
        "atk": 0.1,
        "def": 0.5,
        "luk": 0.1,
        "wis": 0.1,
        "stm": 0.1
    }
}]
          }
        };
      }
      ready() {
        super.ready();
        this.$.drawerButton.addEventListener('click', e => this._toggleMenu(e));
        this.$.top3Request.generateRequest();
      }
      connectedCallback() {
        super.connectedCallback();
        // console.log('connected callback');
      }
      constructor() {
        super();
        //console.log('hi');
        //this.$.iajax.generateRequest();
      }
      handleTop3Response(data) {
        this.top3 = data.detail.response;
        console.log(data.detail.response);
        //this.prop1 = data.detail.response;
      }
      _toggleMenu(e) {
        var drawerLayout = this.$.drawerLayout;
        if (drawerLayout.forceNarrow || !drawerLayout.narrow) {
          drawerLayout.forceNarrow = !drawerLayout.forceNarrow;
        } else {
          drawerLayout.drawer.toggle();
        }
      }
      _emptyBind(str) {
        return str ? str : 'None';
      }
      _calculateRank(num) {
        if (num > 500) {
          return 'S';
        } else {
          return 'C';
        }
      }
    }

    window.customElements.define(MyApp.is, MyApp);
  </script>
</dom-module>
